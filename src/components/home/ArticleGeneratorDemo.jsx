import { useState,useEffect } from 'react'
import { motion } from 'framer-motion'
import { toast } from 'react-hot-toast'
import { api } from '../../lib/api'
import { useAuth } from '../../hooks/useAuth'
export default function ArticleGeneratorDemo(){const {user}=useAuth();const [topic,setTopic]=useState('');const [loading,setLoading]=useState(false);const [result,setResult]=useState(null);const [profile,setProfile]=useState(null);useEffect(()=>{(async()=>{try{setProfile(await api.profile())}catch{}})()},[]);const generate=async()=>{if(!topic.trim())return toast.error('Enter a topic');setLoading(true);try{const data=await api.draftDemo(topic);setResult(data)}catch(e){toast.error(e.message||'Demo failed')}finally{setLoading(false)}};const expand=async()=>{if(!user)return toast('Sign in to expand the demo',{icon:'🔐'});try{const data=await api.draftDemo(result?.topic||topic||'');setResult(data)}catch(e){toast.error(e.message||'Expand failed')}};const quota=profile?`Plan: ${profile.plan} · Articles today ${profile.usage?.articlesToday}/${profile.limits?.articlesPerDay}`:'Checking limits…';return(<div className="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"><div className="flex flex-col gap-4 md:flex-row md:items-end"><div className="flex-1"><label className="block text-sm font-semibold mb-2 text-slate-800">Try the AI writer</label><input value={topic} onChange={e=>setTopic(e.target.value)} placeholder="e.g., Technical SEO for startups" className="w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:border-violet-400 focus:ring-2 focus:ring-violet-200"/><p className="text-xs text-slate-500 mt-2">{quota}</p></div><motion.button onClick={generate} disabled={loading||!topic.trim()} className="px-5 py-3 rounded-xl font-bold bg-violet-600 text-white disabled:opacity-50" whileHover={{scale:loading?1:1.02}} whileTap={{scale:loading?1:.98}}>{loading?'Generating…':'Generate Demo'}</motion.button>{result&&(<motion.button onClick={expand} className="px-5 py-3 rounded-xl font-bold bg-white border border-slate-200 hover:bg-slate-50 text-slate-900" whileHover={{scale:1.02}} whileTap={{scale:.98}}>Expand Draft</motion.button>)}</div>{result&&(<motion.div initial={{opacity:0,y:12}} animate={{opacity:1,y:0}} className="mt-6 rounded-xl bg-slate-50 border border-slate-200 p-5"><h3 className="text-lg font-semibold mb-2 text-slate-900">{result.title||'Draft Preview'}</h3><div className="prose max-w-none">{(result.sections||[]).slice(0,3).map((s,i)=>(<div key={i} className="mb-3">{s.heading&&<h5 className="mt-0">{s.heading}</h5>}<p>{s.content||s.text}</p></div>))}</div></motion.div>)}</div>)}
